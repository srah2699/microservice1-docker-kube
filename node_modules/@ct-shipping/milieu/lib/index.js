"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const async_hooks_1 = require("async_hooks");
class Milieu {
    constructor() {
        this.context = {};
        this.asyncLocalStorage = new async_hooks_1.AsyncLocalStorage();
    }
    run(runnable, ...args) {
        return this.asyncLocalStorage.run(this.context, runnable, ...args);
    }
    get(key) {
        const store = this.asyncLocalStorage.getStore();
        if (!key || !store)
            return store;
        if (key in store)
            return store[key];
        return undefined;
    }
    set(key, value) {
        this.context = Object.assign({}, this.context);
        this.context[key] = value;
    }
    extend(newContext) {
        this.context = Object.assign(Object.assign({}, this.context), newContext);
    }
    reset() {
        this.context = {};
        this.asyncLocalStorage = new async_hooks_1.AsyncLocalStorage();
    }
}
const milieu = new Milieu();
exports.default = milieu;
